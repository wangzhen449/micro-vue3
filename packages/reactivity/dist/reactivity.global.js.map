{
  "version": 3,
  "sources": ["../src/index.ts", "../../shared/src/index.ts", "../src/dep.ts", "../src/effect.ts", "../src/baseHandlers.ts", "../src/reactive.ts", "../src/ref.ts", "../src/computed.ts"],
  "sourcesContent": ["export * from './reactive'\nexport * from './effect'\nexport * from './ref'\nexport * from './computed'", "export * from './shapeFlags'\n\nconst onRE = /^on[^a-z]/\nexport const isOn = (key) => onRE.test(key)\n\nexport const isArray = Array.isArray\n\nexport const isString = (val: unknown): val is string => typeof val === 'string'\n\nexport const isObject = (value: unknown): value is Record<any, any> =>\n  typeof value === 'object' && value !== null\n\nexport const isFunction = (value: unknown): value is Function =>\n  typeof value === 'function'\n\nexport const hasChanged = (value: any, oldValue: any): boolean =>\n  !Object.is(value, oldValue)\n\nexport const NOOP = () => {}\n\nexport const extend = Object.assign\n", "import { ReactiveEffect } from './effect';\nexport type Dep = Set<ReactiveEffect>;\n\n// \u4F7F\u7528Set\u5B58\u50A8\u552F\u4E00\u7684effect\nexport function createDep(effetcs?: ReactiveEffect[]): Dep {\n  const dep = new Set<ReactiveEffect>(effetcs) as Dep;\n  return dep;\n}\n", "import { extend } from '@vue/shared';\nimport { createDep, Dep } from './dep'\n\n/**\n * v effect \u76D1\u542C\u51FD\u6570\u4E2D\uFF0C\u591A\u6B21\u89E6\u53D1\u76F8\u540Cgetter\uFF0C\u53EA\u6536\u96C6\u4E00\u6B21\n * v effect \u907F\u514D\u9012\u5F52\u6267\u884C\n * v effect\u8FD4\u56DErunner\u51FD\u6570\uFF0C\u652F\u6301\u624B\u52A8\u89E6\u53D1\u76D1\u542C\u51FD\u6570\n * v effect\u4F20\u5165\u4E00\u4E2Arunner\uFF0C\u4F1A\u91CD\u65B0\u5305\u88C5\uFF0C\u89E6\u53D1\u4E24\u6B21\n * v effect stop\u529F\u80FD\uFF0C\u652F\u6301\u5728\u8FD0\u884C\u4E2D\u5EF6\u8FDF\u89E6\u53D1\u548C\u8FD0\u884C\u540E\u89E6\u53D1\n * x \u5206\u652F\u7684\u5904\u7406\n * x shouldTrack\n * x trigger \u4E2D key \u4E3A\u7279\u6B8A\u5C5E\u6027\u7684\u5904\u7406\n * v \u5D4C\u5957effect \u5916\u5C42\u4E0D\u4F1A\u6536\u96C6\u5185\u5C42\u4F9D\u8D56\uFF0C\u5185\u5C42\u4E5F\u4E0D\u4F1A\u6536\u96C6\u5916\u5C42\u4F9D\u8D56\u3002\n * x effect \u4F20\u9012\u53C2\u6570\n *   v scheduler \u8C03\u5EA6\u5668 \uFF08\u5F02\u6B65\u66F4\u65B0\u7684\u6838\u5FC3\uFF09\n *\n *\n */\n\n// \u5B58\u50A8\u65B9\u5F0F\u4E3A  WeakMap(target -> Map(key -> dep))\n// \u4F7F\u7528Set\u800C\u4E0D\u662F\u8BA2\u9605\u7684Dep\u7C7B\uFF0C\u662F\u4E3A\u4E86\u8282\u7701\u6027\u80FD\u5F00\u9500\ntype KeyToDepMap = Map<any, Dep>\nconst targetMap = new WeakMap<any, KeyToDepMap>()\n\nexport type EffectScheduler = () => any\n\nexport let activeEffect: ReactiveEffect | undefined\nexport class ReactiveEffect {\n  active = true // \u7528\u4E8E\u6807\u8BC6\u662F\u5426\u88AB\u6FC0\u6D3B\uFF0C\u53EA\u6709\u6FC0\u6D3B\u662F\u624D\u53EF\u4EE5\u88AB\u6536\u96C6\u548C\u89E6\u53D1\n  deps: Dep[] = [] // \u7528\u4E8E\u5B58\u50A8\u5F53\u524Deffect\u6536\u96C6\u7684Dep\uFF0CDep\u4E2D\u5B58\u50A8\u7684\u662FReactiveEffect\u5B9E\u4F8B\n  parent: ReactiveEffect | undefined = undefined // \u4E3A\u4E86\u5D4C\u5957effect\uFF0C\u6807\u8BB0\u4E0A\u5C42activeEffect\n\n  private deferStop?: boolean // \u5EF6\u8FDF\u6E05\u7406\u7684\u6807\u8BC6\n  constructor(public fn, public scheduler: EffectScheduler | null = null) {}\n\n  run() {\n    // \u5982\u679C\u4E0D\u662F\u88AB\u6FC0\u6D3B\u7684\u72B6\u6001(\u6267\u884C\u8FC7onStop\u4E4B\u540E)\uFF0C\u76F4\u63A5\u6267\u884C\u76D1\u542C\u51FD\u6570\n    if (!this.active) {\n      this.fn()\n    }\n\n    try {\n      // \u4E0A\u4E00\u5C42\u7684activeEffect\u5B58\u50A8\u5230\u5BF9\u8C61\u7684parent\u5C5E\u6027\u4E0A\uFF0C\u5FC5\u987B\u5728\u8D4B\u503C\u4E3Athis\u4E4B\u524D\n      this.parent = activeEffect\n      // \u5F53\u524Deffet\uFF0C\u53EF\u88AB\u4F9D\u8D56\u6536\u96C6\n      activeEffect = this\n      // \u5148\u6267\u884C\u4E00\u6B21\n      return this.fn()\n    } finally {\n      // \u4E0B\u5C42run\u51FD\u6570\u6267\u884C\u5B8C\u3002\u5C06\u4E0A\u5C42\u4F9D\u8D56\u7684effect\uFF0C\u8FD4\u8FD8\u7ED9\u5F53\u524D\n      activeEffect = this.parent\n      // \u5F53\u524D\u7684parent\u53EF\u4EE5\u7F6E\u7A7A\u4E86\u3002\n      this.parent = undefined\n\n      // \u5EF6\u8FDF\u6267\u884Cstop\n      if (this.deferStop) {\n        this.stop()\n      }\n    }\n  }\n\n  stop() {\n    // \u5982\u679C\u8FD0\u884C\u4E2D\u6267\u884Cstop\uFF0C\u5C06\u7B49\u5230run\u51FD\u6570\u6267\u884C\u5B8C\uFF0C\u5EF6\u8FDF\u6267\u884C\u3002\n    if (activeEffect === this) {\n      this.deferStop = true\n    } else if (this.active) {\n      // \u662F\u5426\u662F\u6FC0\u6D3B\u72B6\u6001\n      cleanupEffect(this)\n\n      // \u7F6E\u4E3A\u672A\u6FC0\u6D3B\u72B6\u6001\n      this.active = false\n    }\n  }\n}\n\nfunction cleanupEffect(effect: ReactiveEffect) {\n  const { deps } = effect\n  if (deps.length) {\n    // \u53CC\u5411\u5B58\u50A8\u7684\u597D\u5904\uFF0C\u8FD9\u91CC\u5FAA\u73AF\u7684\u662F\u6240\u6709\u4F9D\u8D56\u4E86\u5F53\u524Deffect\u7684 Dep\u3002\n    for (let i = 0; i < deps.length; i++) {\n      // \u5728Dep\u96C6\u5408\u4E2D\u5220\u9664\u6389\u5BF9\u4E8E\u5F53\u524Deffect\u7684\u4F9D\u8D56\u3002\n      deps[i].delete(effect)\n    }\n    // \u6E05\u7A7Adeps\n    deps.length = 0\n  }\n}\n\nexport interface ReactiveEffectOptions {\n  // \u8C03\u5EA6\u5668 \u5728\u4F9D\u8D56\u89E6\u53D1\u65F6\u901A\u8FC7\u8C03\u5EA6\u5668\u7684\u62E6\u622A\uFF0C\u4E0D\u6267\u884Crun\u65B9\u6CD5\uFF0C\u800C\u662F\u6267\u884C\u8C03\u5EA6\u5668\u65B9\u6CD5\n  scheduler?: EffectScheduler\n}\n\nexport interface ReactiveEffectRunner<T = any> {\n  (): T\n  effect: ReactiveEffect\n}\n\nexport function effect<T = any>(\n  fn: () => T,\n  options?: ReactiveEffectOptions\n): ReactiveEffectRunner {\n  // \u5982\u679Ceffect\u4F20\u5165\u7684\u662F\u4E00\u4E2Arunner\uFF0C\u4F7F\u7528runner\u4E0A\u7684ReactiveEffect\u5B9E\u4F8B\u4E0A\u7684fn\n  // \u8FD9\u6837\u4F1A\u91CD\u65B0\u521B\u5EFAReactiveEffect\u5BF9\u8C61 \u8FD9\u6837\u76D1\u542C\u51FD\u6570\u4F1A\u89E6\u53D1\u4E24\u6B21\u3002\uFF08\u5426\u5219\u6267\u884C\u7684\u662F\u4E0A\u6B21\u7684run\u65B9\u6CD5\uFF09\n  if ((fn as ReactiveEffectRunner).effect) {\n    fn = (fn as ReactiveEffectRunner).effect.fn\n  }\n  const _effect = new ReactiveEffect(fn)\n  if(options) {\n    extend(_effect, options)\n  }\n  // \u9996\u5148\u6267\u884C\u4E00\u6B21\uFF0C\u6536\u96C6\u4F9D\u8D56\n  _effect.run()\n\n  // \u5B58\u50A8\u76D1\u542C\u51FD\u6570\u5E76\u8FD4\u56DE\uFF0C\u8FD4\u56DE\u7684\u76D1\u542C\u51FD\u6570\u53EF\u4EE5\u4F9B\u968F\u65F6\u8C03\u7528\u3002\n  const runner = _effect.run.bind(_effect) as ReactiveEffectRunner\n  runner.effect = _effect\n  return runner\n}\n\n// \u6536\u96C6\nexport function track(target: object, key: unknown) {\n  // \u5982\u679C\u6709\u53EF\u88AB\u6536\u96C6\u7684\u4F9D\u8D56\n  if (activeEffect) {\n    // \u5B58\u50A8\u65B9\u5F0F WeakMap(target -> Map(key -> dep)) dep\u4E2D\u5B58\u50A8\u7684\u4E3AReactiveEffect\u5BF9\u8C61\n    let depsMap = targetMap.get(target)\n    if (!depsMap) {\n      targetMap.set(target, (depsMap = new Map()))\n    }\n    let dep = depsMap.get(key)\n    if (!dep) {\n      depsMap.set(key, (dep = createDep()))\n    }\n\n    trackEffects(dep)\n  }\n}\nexport function trackEffects(dep: Dep) {\n  // Set\u4E2D\u6CA1\u6709\u624D\u6267\u884C\u63D2\u5165\u52A8\u4F5C\n  if (!dep.has(activeEffect!)) {\n    dep.add(activeEffect!) // ! \u4E3ATS\u975E\u7A7A\u65AD\u8A00\n    // \u53CC\u5411\u5F15\u7528\n    activeEffect!.deps.push(dep)\n  }\n}\n\n// \u89E6\u53D1\nexport function trigger(target: object, key?: unknown, value?: unknown) {\n  const depsMap = targetMap.get(target)\n  // \u5982\u679C\u6CA1\u6709\u88AB\u6536\u96C6\u8FC7\uFF0C\u76F4\u63A5\u9000\u51FA\n  if (!depsMap) return\n\n  let deps: (Dep | undefined)[] = []\n\n  // \u4E0D\u4F7F\u7528undefined\u7684\u539F\u56E0\u662F\uFF0C\u6709\u4E9B\u6D4F\u89C8\u5668\u5BF9\u4E8Eundefined\u4E0D\u662F\u4FDD\u7559\u5B57\u6216\u5173\u952E\u5B57\uFF0C\u53EF\u5BF9\u5176\u8FDB\u884C\u4FEE\u6539\u3002\u800Cvoid 0\u8FD4\u56DE\u7684\u662F\u7EAF\u6B63\u7684undefined\n  // \u5982\u679Ckey\u6709\u503C\uFF0C\u5C06\u83B7\u53D6\u5230\u7684dep\u653E\u5165\u5230deps\u4E2D\u3002\n  if (key !== void 0) {\n    deps.push(depsMap.get(key))\n  }\n\n  if (deps.length === 1) {\n    triggerEffects(deps[0])\n  }\n}\nexport function triggerEffects(dep: Dep) {\n  // \u7EDF\u4E00\u4E3A\u6570\u7EC4\u7C7B\u578B\n  const effects = Array.isArray(dep) ? dep : [...dep]\n  for (const effect of effects) {\n    triggerEffect(effect)\n  }\n}\n\nfunction triggerEffect(effect: ReactiveEffect) {\n  // \u5904\u7406\u9012\u5F52\u5F15\u7528\uFF0C\u9020\u6210\u6808\u6EA2\u51FA\u7684\u89E3\u51B3\u65B9\u5F0F\u3002\n  // \u5F53effect\u4F20\u5165\u7684\u76D1\u542C\u51FD\u6570\u4E2D\uFF0C\u6709\u4FEE\u6539proxy\u7684\u5C5E\u6027\u503C\u65F6\uFF0C\u4F1A\u9020\u6210\u5FAA\u73AF\u8C03\u7528\u81EA\u8EABrun\u65B9\u6CD5\u7684\u95EE\u9898\u3002\n  // effect() -> run() -> fn() -> \u66F4\u6539\u5C5E\u6027\u89E6\u53D1trigger() -> run() -> fn()  \u9020\u6210\u5FAA\u73AF\u8C03\u7528\n  // \u6240\u4EE5\u5FC5\u987B\u5224\u65AD\uFF0C\u89E6\u53D1\u7684\u76D1\u542C\u51FD\u6570\u4E0D\u80FD\u662F\u5F53\u524D\u6B63\u6FC0\u6D3B\u7684activeEffect\n  if (effect !== activeEffect) {\n    // \u89E6\u53D1\u7684\u65F6\u5019\uFF0C\u8C03\u5EA6\u5668\u5C06\u62E6\u622Arun\u65B9\u6CD5\u7684\u6267\u884C\n    if(effect.scheduler) {\n      effect.scheduler()\n    } else {\n      effect.run()\n    }\n  }\n}\n", "import { hasChanged, isObject } from \"@vue/shared\";\nimport { track, trigger } from \"./effect\";\nimport { reactive, ReactiveFlags, reactiveMap, Target } from \"./reactive\";\nhasChanged;\nconst get = createGetter();\nconst set = createSetter();\n\nexport const mutableHandlers: ProxyHandler<object> = {\n  get,\n  set,\n  // deleteProperty,\n  // has,\n  // ownKeys\n};\n\nfunction createGetter() {\n  return function get(target: Target, key: string | symbol, receiver: object) {\n    if (key === ReactiveFlags.IS_REACTIVE) {\n      // \u662F\u5426\u88AB\u4EE3\u7406\u7684\u6807\u8BC6\u3002\n      return true;\n    } else if (\n      key === ReactiveFlags.RAW &&\n      receiver === reactiveMap.get(target)\n    ) {\n      // \u5982\u679C\u83B7\u53D6\u539F\u59CB\u5BF9\u8C61\uFF0C\u5E76\u4E14\u4EE3\u7406\u5BF9\u8C61\u662F\u4EE5\u539F\u59CB\u5BF9\u8C61\u6536\u96C6\u7684\uFF0C\u76F4\u63A5\u8FD4\u56DE\u539F\u59CB\u5BF9\u8C61\n      return target;\n    }\n    const res = Reflect.get(target, key);\n    // \u6536\u96C6\u4F9D\u8D56 \u521B\u5EFAdep -> effects\u4E2D\u63D2\u5165 -> effect\n    track(target, key);\n\n    // \u5982\u679C\u662F\u5BF9\u8C61\uFF0C\u4E5F\u8F6C\u4E3A\u4EE3\u7406\n    if (isObject(res)) {\n      return reactive(res);\n    }\n    return res;\n  };\n}\nfunction createSetter() {\n  return function set(target, key, value) {\n    const oldValue = (target as any)[key];\n    const result = Reflect.set(target, key, value);\n    if (hasChanged(value, oldValue)) {\n      // \u89E6\u53D1\u4F9D\u8D56 \u627E\u5230dep -> \u904D\u5386effects -> \u6267\u884C\u6BCF\u4E00\u4E2Aeffect\n      trigger(target, key, value);\n    }\n    return result;\n  };\n}\n", "import { isObject } from \"@vue/shared\";\nimport { mutableHandlers } from \"./baseHandlers\";\n\nexport const enum ReactiveFlags {\n  // \u662F\u5426\u662Freactive\u7684\u6807\u8BC6\u3002\u901A\u8FC7\u5176\u6765\u5224\u65AD\u662F\u5426\u88ABproxy\u4EE3\u7406\u8FC7\u3002\u5426\u5219\u9700\u8981\u6539\u5199[Symbol.toStringTag]\u503C\u624D\u65B9\u4FBF\u5224\u65AD\u3002\n  // \u6CA1\u6709\u8D4B\u503C\u64CD\u4F5C\uFF0C\u662F\u5728\u4EE3\u7406\u7684get\u51FD\u6570\u4E2D\u5224\u65AD\u7684\u3002\n  IS_REACTIVE = \"__v_isReactive\",\n\n  // \u539F\u59CB\u5BF9\u8C61\u6807\u8BC6\n  RAW = '__v_raw'\n}\n\nexport interface Target {\n  [ReactiveFlags.IS_REACTIVE]?: boolean;\n\n  [ReactiveFlags.RAW]?: any;\n}\n\nexport const reactiveMap = new WeakMap<Target, any>();\n\n// export function reactive<T extends object>(target: T): ProxyConstructor;\nexport function reactive(target) {\n  return createReactive(target, mutableHandlers, reactiveMap);\n}\n\nfunction createReactive(\n  target: any,\n  baseHandlers: ProxyHandler<any>,\n  proxyMap\n) {\n  // \u5982\u679C\u4E0D\u662F\u5BF9\u8C61\uFF0C\u76F4\u63A5\u8FD4\u56DE\n  if (!isObject(target)) {\n    return target;\n  }\n\n  // \u5982\u679C\u5DF2\u7ECF\u662F\u54CD\u5E94\u5F0F\u5BF9\u8C61\uFF0C\u76F4\u63A5\u8FD4\u56DE\n  if (target[ReactiveFlags.IS_REACTIVE]) {\n    return target;\n  }\n\n  // \u5DF2\u5728Map\u4E2D\u7F13\u5B58\u7684\u76F4\u63A5\u4F7F\u7528\n  const existingProxy = proxyMap.get(target);\n  if (existingProxy) {\n    return existingProxy;\n  }\n\n  // \u4F7F\u7528proxy\u4EE3\u7406\n  const proxy = new Proxy(target, baseHandlers);\n  // \u5B58\u50A8\u5230Map\u4E2D\n  proxyMap.set(target, proxy);\n\n  return proxy;\n}\n\nexport function isReactive(value): boolean {\n  // \u8F6C\u4E3A\u5E03\u5C14\u503C\n  return !!(value && value[ReactiveFlags.IS_REACTIVE]);\n}\n\nexport function toRaw(observed) {\n  // \u5982\u679C\u5305\u542B__v_raw \u5C31\u53D6\u91CC\u9762\u7684\u539F\u59CB\u503C\n  // \uFF1F\uFF1F\uFF1F \u6E90\u7801\u4E2D\u6709\u5904\u7406\u591A\u5C42\u4EE3\u7406\u5D4C\u5957\u7684\u60C5\u51B5\uFF0C\u4E0D\u6E05\u695A\u4EC0\u4E48\u65F6\u5019\u4F1A\u51FA\u73B0\n  // return observed[ReactiveFlags.RAW] ? observed[ReactiveFlags.RAW] : observed;\n  return (observed && observed[ReactiveFlags.RAW]) || observed;\n}\n\n// \u5982\u679C\u662F\u5BF9\u8C61\uFF0C\u8F6C\u5316\u4E3Aproxy\nexport const toReactive = <T extends unknown>(value: T): T =>\n isObject(value) ? reactive(value) : value;\n", "import { hasChanged } from \"@vue/shared\";\nimport { createDep, Dep } from \"./dep\";\nimport { trackEffects, activeEffect, triggerEffects } from \"./effect\";\nimport { toReactive, toRaw } from \"./reactive\";\n\nexport interface Ref<T = any> {\n  value: T;\n}\n\ntype RefBase<T> = {\n  dep?: Dep;\n  value: T;\n};\n\nexport function trackRefValue(ref: RefBase<any>) {\n  // \u5982\u679C\u5F53\u524D\u6709\u6FC0\u6D3B\u7684effect\n  if (activeEffect) {\n    // \u5904\u7406reactive\u5305\u88F9ref\u7684\u60C5\u51B5\n    ref = toRaw(ref);\n    // \u8C03\u7528\u6536\u96C6effect\n    trackEffects(ref.dep || (ref.dep = createDep()));\n  }\n}\nexport function triggerRefValue(ref: RefBase<any>) {\n  // \u5904\u7406reactive\u5305\u88F9ref\u7684\u60C5\u51B5\n  ref = toRaw(ref);\n  if (ref.dep) {\n    // \u8C03\u7528\u89E6\u53D1effect\n    triggerEffects(ref.dep);\n  }\n}\n\nexport function isRef(r: any): r is Ref {\n  return !!(r && r.__v_isRef === true);\n}\n\nexport function ref(value?: unknown) {\n  return createRef(value);\n}\n\nfunction createRef(rawValue: unknown) {\n  // \u5982\u679C\u5DF2\u7ECF\u662Fref \u8FD4\u56DE\u81EA\u8EAB\n  if (isRef(rawValue)) {\n    return rawValue;\n  } else {\n    // \u521B\u5EFAref\n    return new RefImpl(rawValue);\n  }\n}\n\nclass RefImpl<T> {\n  private _value: T;\n  private _rawValue: T;\n\n  public dep: Dep = undefined;\n  public readonly __v_isRef = true;\n  constructor(value: T) {\n    // \u5982\u679Cvalue\u662Fproxy\uFF0C\u4F7F\u7528\u539F\u59CB\u503C\u4FDD\u5B58\n    this._rawValue = toRaw(value);\n    // \u5982\u679C\u662F\u5BF9\u8C61\uFF0C\u53D8\u4E3Aproxy\n    this._value = toReactive(value);\n  }\n  get value() {\n    // \u6536\u96C6\u4F9D\u8D56\n    trackRefValue(this);\n    return this._value;\n  }\n  set value(newVal) {\n    newVal = toRaw(newVal);\n    // \u4F7F\u7528\u539F\u59CB\u5BF9\u8C61\u6BD4\u8F83\n    if (hasChanged(newVal, this._rawValue)) {\n      this._rawValue = newVal;\n      this._value = toReactive(newVal);\n      // \u89E6\u53D1\u4F9D\u8D56\n      triggerRefValue(this);\n    }\n  }\n}\n\n// \u89E6\u53D1ref\u7684effect\nexport function triggerRef(ref: Ref) {\n  triggerRefValue(ref);\n}\n\n// \u8FD4\u56DEref\u7684value\u5C5E\u6027\nexport function unRef(ref) {\n  return isRef(ref) ? ref.value : ref;\n}\n", "import { ReactiveEffect } from './effect'\nimport { isFunction, NOOP } from '@vue/shared'\nimport { Dep } from './dep'\nimport { trackRefValue, triggerRefValue } from './ref';\n\ntype ComputedGetter<T> = () => T\ntype ComputedSetter<T> = (v: T) => void\ntype WritableComputedOptions<T> = {\n  get: ComputedGetter<T>\n  set?: ComputedSetter<T>\n}\n/**\n * v \u652F\u6301get\u51FD\u6570\uFF0C\u6216\u8005\u5BF9\u8C61get\u3001set\u7684\u53C2\u6570\n * v \u8BA1\u7B97\u5C5E\u6027\u662F effect \u5957 effect\n * v \u8BA1\u7B97\u5C5E\u6027\u662F\u7C7Bref\n * v scheduler \u6BCF\u6B21\u503C\u53D8\u5316\u90FD\u4F1A\u6267\u884C\u3002\u4F46\u4F55\u65F6\u53D6\u503C\uFF0C\u53D6\u51B3\u4E8E\u4F55\u65F6\u8BFB\u53D6computed\u7684value\u503C\uFF0C\u8BFB\u53D6value\u503C\u6709\u4E24\u79CD\u65B9\u5F0F\uFF1A\n *    \u4E00\u79CD\u662F\uFF0C\u76F4\u63A5\u83B7\u53D6computed\u7684value\u503C\uFF08\u8FD9\u5C31\u662F\u7F13\u5B58\u7684\u539F\u56E0\uFF09\uFF1B\u53E6\u4E00\u79CD\u901A\u8FC7\u89E6\u53D1computed\u5305\u88F9\u7684effect\uFF0C\u8BFB\u53D6computed\u7684value\u3002\n *\n */\nclass ComputedImpl<T> {\n  public dep: Dep = undefined\n  private _value: T\n  private readonly effect: ReactiveEffect\n\n  public readonly __v_isRef = true\n  public _dirty: boolean = true // \u9ED8\u8BA4\u53D6\u503C\u7684\u65F6\u5019\u8FDB\u884C\u8BA1\u7B97\n  constructor(\n    getters: ComputedGetter<T>,\n    private readonly _setter: ComputedSetter<T>\n  ) {\n    this.effect = new ReactiveEffect(getters, () => {\n      // \u6BCF\u6B21getter\u4E2D\u7684\u54CD\u5E94\u5F0F\u5C5E\u6027\u4FEE\u6539\u90FD\u4F1A\u8FDB\u5165\uFF0C\u901A\u8FC7_dirty\u6765\u63A7\u5236\u662F\u5426\u89E6\u53D1\u4F9D\u8D56\n      if (!this._dirty) {\n        this._dirty = true\n        // \u89E6\u53D1computed\u7684effect\u4F9D\u8D56\uFF0C\u7531\u4E8E\u89E6\u53D1\u4F9D\u8D56\u4F1A\u518D\u6B21\u6267\u884Ccomputed\u7684get\u51FD\u6570\uFF0C\u503C\u4F1A\u518D\u6B21\u66F4\u65B0\u3002\n        triggerRefValue(this)\n      }\n    })\n  }\n  get value() {\n    // \u6536\u96C6\u4F9D\u8D56\n    trackRefValue(this)\n    if (this._dirty) {\n      this._dirty = false\n      // \u8BA1\u7B97\u5C5E\u6027\u7684\u8FD4\u56DE\u503C\n      this._value = this.effect.run()\n    }\n    return this._value\n  }\n  set value(newValue: T) {\n    this._setter(newValue)\n  }\n}\n\nexport function computed<T>(\n  getterOrOptions: ComputedGetter<T> | WritableComputedOptions<T>\n) {\n  let getter: ComputedGetter<T>\n  let setter: ComputedSetter<T>\n\n  // \u53EA\u4F20\u5165\u51FD\u6570\u5F53getter\u5904\u7406\u3002\n  const onlyGetter = isFunction(getterOrOptions)\n  if (onlyGetter) {\n    getter = getterOrOptions\n    // \u8865\u5145setter\u4E3A\u7A7A\u51FD\u6570\n    setter = NOOP\n  } else {\n    // \u5BF9\u8C61\u5F62\u5F0F\n    getter = getterOrOptions.get\n    setter = getterOrOptions.set\n  }\n\n  const cRef = new ComputedImpl(getter, setter)\n  return cRef\n}\n"],
  "mappings": "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",
  "names": []
}
